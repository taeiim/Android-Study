# Android Paging Library

## 1. 들어가기전...

페이징은 데이터베이스의 데이터를 일정한 덩어리로 나눠서 제공하는 것을 의미합니다.  
서버-클라이언트 모델에서는 주로 서버에서 페에징을 구현한 뒤, 클라이언트를 통해 사용자가  
열람한 페이지의 정보를 보여주는 것이 일반적입니다.

만약 페이징을 안하고 사용자한테 데이터를 보여주면 어떻게 될까요?  
Google 에 Android 를 검색하면 검색결과가 약 28 억개나 된다고 합니다.  

그리고 28 억개의 검색결과를 다 보여줄 때, 1개의 검색 결과 1byte 의 크기를 차지한다고 가정하면 사용자는  
약 2.8 Gbyte 의 크기를 읽어와야 된다는 것입니다.

결국 사용자가 한번 검색할 때마다 아주 큰 네트워크 비용을 들게 됩니다.  
이렇게 큰 비용을 감수하고 검색을 하는 사용자는 없을 것입니다.

그래서 페이징을 통해 데이터를 나누어서 사용자에게 보여주는 이유입니다.

자, 그렇다면 모바일 앱에서의 페이징은 어떨까요?

## 2-1. Android 에서의 전형적인 페이징 기법  

모바일 앱에서 페이징은 그렇게 생소하거나 새로운 기법은 아닙니다.  
이미 무한 스크롤링 과 지연 로딩 기법 이라 불리는 방법으로 모바일 앱 시장에서 많이 사용되는 패턴들이 있으며,

이 패턴들을 구현하는 방법은 널리 알려진지 오래입니다.  

그렇다면 무한 스크롤링과 지연 로딩 기법은 무엇일까요? 

### 무한 스크롤링

무한 스크롤링에 대해 간단하게 설명하면
OnScrollListener 를 이용해 스크롤이 하단에 도달하게 될 때,  
데이터들을 점진적으로 가져오는 방법입니다.

무한 스크롤링은 페이스북과 같이 전체 리스트를 보여주는게 중요한게 아닌 앱에서 사용됩니다.

### 지연 로딩 기법

지연 로딩 기법은  
연락처 앱과 같이 처움에 모든 데이터들을 가져와 리스트를 만드는 방법을 말합니다.  
이는 패스트 스크롤이 가능하게 만듭니다.

## 2-2. 문제점

몰론 기존 방법으로 구현하는데에는 문제점들이 있습니다.

### 무한 스크롤링
- RecylerView 스크롤 시 아이템을 다루는 방법이 필요
- 스크롤 방향, 이미 페이지가 로딩 중인지, 더 이상 불러올 데이터가 없을 때 같은 상황을 모두 고려 해야됨.
- 다음 페이지 호출 시점을 알아내기 위한 UI 처리에도 집중이 필요
- 무엇보다 공식적인 가이드가 부재...

### 지연 로딩 기법
- 불러올 데이터가 클 수록 지연이 커지고 말 것이다.
- 결국 사용자는 그동안 아무것도 못하게 된다...


개발자가 이러한 문제점들을 고려해서 구현하기에는 꽤 많은 비용과 시간이 듭니다.

## 3. Paging Library

2017년 9월, Google 에서 Android Paging Libaray 를 발표를 했습니다.  

Paging Library는 대량의 데이터 셋을 청크 단위로 RecyclerView 에 쉽게 로드할 수 있게 해줍니다.  
무엇보다 위에 언급했던 문제들을 해결해주는 새로운 방식으로 구현 되어 있습니다.

Paging Library는 Room 이 대량의 쿼리 결과를 어떻게 다룰지에서 비롯 되었습니다.  
SQLiteCursor 는 내부적으로 CusorWindow 를 통해 2MB의 고정된 페이징을 구현합니다.  

쿼리의 결과가 10MB 라고 할 때, 쿼리 결과를 한번에 적재하지 않고 이중 일부인 2MB 만을  
CursorWindow 에 로드한다는 의미입니다.  

만약 SQLiteCursor 가 존재하지 않는 행을 요청하게 되면  
CusorWindow 는 해당 행이 존재하는 청크를 불러와 윈도우를 다시 로드하는 형태로 페이징을 수행합니다.

하지만 CusorWindow 를 이용한 내부 페이징은 몇 가지 이유로 성능 문제를 일으킬 수 있고  
예측 불가능한 부분이 있다고 합니다.

그래서 Paging Library 는 단일 CursorWindow 내에서 동작하는 (SQLiteCursor 의 내부페이징이 동작하지 않도록)  
스몰 쿼리를 지향하는 것이 핵심이라고 합니다.

Paging Library 는 PagedList, DataSource, PagedListAdapter 로 구성되어 있습니다.

